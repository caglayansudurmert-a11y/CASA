<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kronos - KÃ¼resel Takip</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@300;500;700&display=swap');
        
        body {
            margin: 0;
            overflow: hidden;
            font-family: 'Rajdhani', sans-serif;
            background-color: #020617;
            color: white;
        }

        /* UI KatmanÄ± */
        #ui-layer {
            position: absolute;
            inset: 0;
            z-index: 10;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .interactive { pointer-events: auto; }

        .glass-panel {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        .glow-text { text-shadow: 0 0 20px rgba(59, 130, 246, 0.6); }

        .country-item {
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }
        .country-item:hover {
            background: rgba(59, 130, 246, 0.1);
            border-left-color: #f97316;
            padding-left: 1rem;
        }
        .country-item.active {
            background: linear-gradient(90deg, rgba(34,197,94,0.15) 0%, transparent 100%);
            border-left-color: #22c55e;
        }

        /* Alarm Animasyonu */
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 20px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .alarm-active {
            animation: pulse-red 1.5s infinite;
            border-color: #ef4444 !important;
            background-color: #1f0505;
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #3b82f6; border-radius: 3px; }
    </style>
</head>
<body>

    <!-- 3D Canvas -->
    <div id="canvas-container" class="absolute inset-0 z-0 bg-gradient-to-b from-[#020617] to-[#0f172a]"></div>

    <!-- UI -->
    <div id="ui-layer" class="p-6 md:p-8">
        
        <!-- Header -->
        <header class="flex justify-between items-start w-full interactive z-20">
            <div>
                <h1 class="text-5xl font-bold tracking-widest text-white glow-text">KRONOS</h1>
                <div class="h-1 w-20 bg-blue-500 mt-1 rounded-full"></div>
                <p class="text-blue-300 text-xs mt-1 uppercase tracking-[0.3em]">Zaman & Alarm Sistemi</p>
            </div>
            <div class="text-right">
                <button onclick="toggleReminderList()" class="interactive group flex items-center gap-2 px-4 py-2 rounded-full border border-white/10 bg-white/5 hover:bg-white/10 transition-all">
                    <div class="relative">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-400 group-hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9" />
                        </svg>
                        <span id="alarm-badge" class="absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full hidden"></span>
                    </div>
                    <span class="text-sm font-bold text-gray-300 group-hover:text-white">ALARMLAR</span>
                </button>
            </div>
        </header>

        <!-- Ana Saat -->
        <main class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full text-center pointer-events-none z-10">
            <div class="transition-all duration-700" id="main-clock-container">
                
                <div class="flex flex-col items-center justify-center gap-2 mb-4 interactive">
                    <div class="flex items-center gap-3 bg-black/40 px-6 py-2 rounded-full backdrop-blur-md border border-white/10 shadow-2xl cursor-pointer hover:border-blue-500/50 transition-all group" onclick="openSetReminderModal()">
                        <img id="selected-country-flag" src="" class="w-8 h-auto rounded shadow-sm hidden">
                        <h2 id="selected-country-name" class="text-xl md:text-3xl text-white font-bold tracking-widest uppercase">YÃœKLENÄ°YOR</h2>
                        <div class="w-8 h-8 bg-blue-600/20 rounded-full flex items-center justify-center group-hover:bg-blue-600 transition-colors">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                            </svg>
                        </div>
                    </div>
                </div>
                
                <div id="main-clock" class="text-8xl md:text-[10rem] font-bold text-white tracking-tighter leading-none drop-shadow-[0_0_60px_rgba(59,130,246,0.3)] select-none tabular-nums">
                    00:00
                </div>

                <div class="mt-6 flex items-center justify-center gap-4">
                    <span id="date-display" class="text-blue-200 bg-blue-900/20 border border-blue-500/20 px-4 py-1 rounded backdrop-blur-sm">...</span>
                </div>
            </div>
        </main>

        <!-- Liste -->
        <div class="absolute bottom-6 right-6 w-full max-w-sm glass-panel rounded-2xl overflow-hidden flex flex-col interactive shadow-2xl max-h-[40vh]">
            <div class="p-3 border-b border-white/10 bg-black/20">
                <input type="text" id="search-input" placeholder="Ãœlke Ara..." class="w-full bg-transparent text-white border-none focus:ring-0 placeholder-gray-500 text-sm">
            </div>
            <div id="country-list" class="overflow-y-auto p-2 space-y-1 custom-scroll"></div>
        </div>
    </div>

    <!-- ALARM MODALI -->
    <div id="reminder-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm hidden interactive">
        <div class="bg-[#0f172a] border border-blue-500/30 p-8 rounded-2xl w-full max-w-md shadow-2xl transform scale-100">
            <h3 class="text-2xl font-bold text-white mb-1">Alarm Kur</h3>
            <p class="text-blue-400 text-xs mb-6 uppercase tracking-wider" id="modal-subtitle">...</p>
            
            <div class="space-y-4">
                <div class="bg-blue-900/20 p-4 rounded border border-blue-500/20">
                    <label class="block text-blue-300 text-xs mb-1 font-bold">HEDEF SAAT (SeÃ§ilen Ãœlkenin Saati)</label>
                    <input type="datetime-local" id="reminder-time" class="w-full bg-gray-900 text-white p-3 rounded border border-gray-700 focus:border-blue-500 outline-none">
                </div>
                
                <div>
                    <label class="block text-gray-400 text-xs mb-1">NOT</label>
                    <input type="text" id="reminder-note" placeholder="HatÄ±rlatÄ±cÄ± notu..." class="w-full bg-gray-900 text-white p-3 rounded border border-gray-700 outline-none">
                </div>
            </div>

            <div class="flex justify-between items-center mt-8">
                <button onclick="testNotification()" class="text-xs text-blue-400 hover:text-blue-300 underline">Bildirimleri Test Et</button>
                <div class="flex gap-3">
                    <button onclick="closeModal('reminder-modal')" class="px-4 py-2 text-gray-400 hover:text-white">Ä°ptal</button>
                    <button onclick="saveReminder()" class="px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded font-bold shadow-lg transition-all">AlarmÄ± Kur</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ALARM Ã‡ALMA EKRANI (Overlay) -->
    <div id="alarm-overlay" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/90 backdrop-blur-xl hidden interactive">
        <div class="text-center alarm-active p-10 rounded-3xl shadow-[0_0_100px_rgba(239,68,68,0.8)] max-w-lg w-full border-2 border-red-500 relative overflow-hidden">
            
            <div class="absolute inset-0 bg-red-500/10 animate-pulse"></div>
            
            <div class="relative z-10">
                <div class="w-24 h-24 bg-red-600 rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg animate-bounce">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                </div>
                
                <h2 class="text-4xl font-bold text-white mb-2 tracking-tighter">ALARM!</h2>
                <p class="text-red-300 text-sm uppercase tracking-[0.3em] mb-8" id="alarm-country-title">TÃœRKÄ°YE</p>
                
                <div class="bg-black/40 p-6 rounded-xl mb-8 text-left border border-white/10">
                    <p class="text-gray-500 text-xs font-bold mb-2">NOTUNUZ:</p>
                    <p class="text-white text-xl font-medium leading-relaxed" id="alarm-note-display">...</p>
                </div>

                <button onclick="dismissAlarm()" class="w-full py-4 bg-white text-black hover:bg-gray-200 rounded-xl font-bold text-lg shadow-xl transition-transform active:scale-95">
                    ALARMI KAPAT
                </button>
            </div>
        </div>
    </div>

    <!-- LÄ°STE MODALI -->
    <div id="list-modal" class="fixed inset-0 z-40 flex items-center justify-center bg-black/80 hidden interactive">
        <div class="bg-gray-900 border border-gray-700 p-6 rounded-2xl w-full max-w-lg h-[50vh] flex flex-col">
            <div class="flex justify-between items-center mb-4 border-b border-gray-800 pb-4">
                <h3 class="text-xl font-bold text-white">Aktif Alarmlar</h3>
                <button onclick="toggleReminderList()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>
            <div id="active-reminders-list" class="overflow-y-auto flex-1 space-y-2"></div>
        </div>
    </div>

    <script>
        // --- DATA ---
        const countries = [
            { name: "TÃ¼rkiye (Ä°stanbul)", tz: "Europe/Istanbul", lat: 41.0082, lon: 28.9784, code: "tr" },
            { name: "ABD (New York)", tz: "America/New_York", lat: 40.7128, lon: -74.0060, code: "us" },
            { name: "Japonya (Tokyo)", tz: "Asia/Tokyo", lat: 35.6762, lon: 139.6503, code: "jp" },
            { name: "Almanya (Berlin)", tz: "Europe/Berlin", lat: 52.5200, lon: 13.4050, code: "de" },
            { name: "Ä°ngiltere (Londra)", tz: "Europe/London", lat: 51.5074, lon: -0.1278, code: "gb" },
            { name: "Rusya (Moskova)", tz: "Europe/Moscow", lat: 55.7558, lon: 37.6173, code: "ru" },
            { name: "Ã‡in (Pekin)", tz: "Asia/Shanghai", lat: 39.9042, lon: 116.4074, code: "cn" },
            { name: "Azerbaycan", tz: "Asia/Baku", lat: 40.4093, lon: 49.8671, code: "az" },
            { name: "Fransa", tz: "Europe/Paris", lat: 48.8566, lon: 2.3522, code: "fr" },
            { name: "GÃ¼ney Kore", tz: "Asia/Seoul", lat: 37.5665, lon: 126.9780, code: "kr" },
            { name: "Hindistan", tz: "Asia/Kolkata", lat: 28.6139, lon: 77.2090, code: "in" },
            { name: "Brezilya", tz: "America/Sao_Paulo", lat: -23.5505, lon: -46.6333, code: "br" },
            { name: "Avustralya", tz: "Australia/Sydney", lat: -33.8688, lon: 151.2093, code: "au" },
            { name: "Ä°talya", tz: "Europe/Rome", lat: 41.9028, lon: 12.4964, code: "it" },
            { name: "Kanada (Toronto)", tz: "America/Toronto", lat: 43.6532, lon: -79.3832, code: "ca" }
        ];

        let selectedCountry = countries[0];
        let reminders = JSON.parse(localStorage.getItem('kronos_reminders')) || [];
        let activeAlarm = null;
        let titleInterval = null; // BaÅŸlÄ±k yanÄ±p sÃ¶nmesi iÃ§in

        // --- THREE.JS ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x020617, 0.02);
        const camera = new THREE.PerspectiveCamera(45, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.z = 16;

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.getElementById('canvas-container').appendChild(renderer.domElement);

        const earthGroup = new THREE.Group();
        scene.add(earthGroup);

        // KÃ¼re
        const geometry = new THREE.IcosahedronGeometry(5, 3);
        const wireMat = new THREE.MeshBasicMaterial({ color: 0x1e40af, wireframe: true, transparent: true, opacity: 0.1 });
        earthGroup.add(new THREE.Mesh(geometry, wireMat));
        
        const pointsMat = new THREE.PointsMaterial({ color: 0x60a5fa, size: 0.06, transparent: true, opacity: 0.4 });
        earthGroup.add(new THREE.Points(geometry, pointsMat));

        const coreMat = new THREE.MeshBasicMaterial({ color: 0x000000 });
        earthGroup.add(new THREE.Mesh(new THREE.SphereGeometry(4.95, 32, 32), coreMat));

        const markerGroup = new THREE.Group();
        earthGroup.add(markerGroup);
        
        const ringMat = new THREE.MeshBasicMaterial({ color: 0xf97316, side: THREE.DoubleSide, transparent: true, opacity: 0.8 });
        const ring = new THREE.Mesh(new THREE.RingGeometry(0.15, 0.2, 32), ringMat);
        ring.position.z = 5.05;
        markerGroup.add(ring);

        const dot = new THREE.Mesh(new THREE.CircleGeometry(0.1, 32), new THREE.MeshBasicMaterial({ color: 0xffffff }));
        dot.position.z = 5.05;
        markerGroup.add(dot);

        const starGeo = new THREE.BufferGeometry();
        const starPos = new Float32Array(2000 * 3);
        for(let i=0; i<6000; i++) starPos[i] = (Math.random() - 0.5) * 100;
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        scene.add(new THREE.Points(starGeo, new THREE.PointsMaterial({ color: 0xffffff, size: 0.1, transparent: true, opacity: 0.5 })));

        // --- BÄ°LDÄ°RÄ°M YÃ–NETÄ°MÄ° ---

        function requestNotificationPermission() {
            if (!("Notification" in window)) {
                alert("TarayÄ±cÄ±nÄ±z bildirimleri desteklemiyor.");
                return;
            }
            Notification.requestPermission().then(permission => {
                if (permission !== "granted") {
                    console.log("Bildirim izni verilmedi.");
                }
            });
        }

        // Sayfa yÃ¼klendiÄŸinde ve tÄ±klamalarda izin iste
        document.addEventListener('DOMContentLoaded', requestNotificationPermission);

        function testNotification() {
            if (Notification.permission === "granted") {
                new Notification("Test BaÅŸarÄ±lÄ±!", {
                    body: "Kronos bildirimleri dÃ¼zgÃ¼n Ã§alÄ±ÅŸÄ±yor.",
                    icon: "https://flagcdn.com/w80/tr.png"
                });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission().then(permission => {
                    if (permission === "granted") {
                        new Notification("Test BaÅŸarÄ±lÄ±!", { body: "Ä°zin verildi ve Ã§alÄ±ÅŸÄ±yor." });
                    }
                });
            } else {
                alert("Bildirim izni engellenmiÅŸ. TarayÄ±cÄ± ayarlarÄ±ndan (adres Ã§ubuÄŸundaki kilit simgesi) izin vermelisiniz.");
            }
        }

        function openSetReminderModal() {
            // Ä°zin kontrolÃ¼
            requestNotificationPermission();

            const now = new Date();
            const parts = new Intl.DateTimeFormat('en-CA', {
                timeZone: selectedCountry.tz,
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', hour12: false
            }).formatToParts(now);
            
            const val = `${parts[0].value}-${parts[2].value}-${parts[4].value}T${parts[6].value}:${parts[8].value}`;
            
            document.getElementById('reminder-time').value = val;
            document.getElementById('modal-subtitle').innerText = selectedCountry.name;
            document.getElementById('reminder-modal').classList.remove('hidden');
        }

        function closeModal(id) {
            document.getElementById(id).classList.add('hidden');
        }

        function saveReminder() {
            const timeInput = document.getElementById('reminder-time').value;
            const note = document.getElementById('reminder-note').value;
            
            if(!timeInput) return alert("LÃ¼tfen saat seÃ§in.");

            const targetDateLocal = new Date(timeInput);
            const now = new Date();
            const localParts = new Intl.DateTimeFormat('en-CA', {
                timeZone: selectedCountry.tz,
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false
            }).formatToParts(now);
            
            const currentCountryTimeStr = `${localParts[0].value}-${localParts[2].value}-${localParts[4].value}T${localParts[6].value}:${localParts[8].value}:${localParts[10].value}`;
            const currentCountryDate = new Date(currentCountryTimeStr);
            
            const diff = targetDateLocal.getTime() - currentCountryDate.getTime();
            
            if(diff < 0) return alert("Ä°leri bir saat seÃ§melisiniz.");

            const realTargetTime = Date.now() + diff;

            reminders.push({
                id: Date.now(),
                country: selectedCountry.name,
                code: selectedCountry.code,
                targetTime: realTargetTime,
                displayTime: timeInput.replace('T', ' '),
                note: note || "Not Yok"
            });

            localStorage.setItem('kronos_reminders', JSON.stringify(reminders));
            closeModal('reminder-modal');
            updateBadge();
            
            // KullanÄ±cÄ±ya onay bildirimi
            if(Notification.permission === "granted") {
                new Notification("Alarm Kuruldu", { body: `${selectedCountry.name} iÃ§in alarm aktif.` });
            }
        }

        function checkReminders() {
            const now = Date.now();
            reminders.forEach((rem, index) => {
                if (now >= rem.targetTime && !activeAlarm) {
                    triggerAlarm(rem);
                }
            });
        }

        function triggerAlarm(rem) {
            activeAlarm = rem;
            flashTitle("ðŸ”” ALARM! ðŸ””", "KRONOS");

            if(Notification.permission === "granted") {
                try {
                    const notif = new Notification(`ALARM: ${rem.country}`, {
                        body: rem.note,
                        icon: `https://flagcdn.com/w80/${rem.code}.png`,
                        requireInteraction: true
                    });
                    notif.onclick = function() { 
                        window.focus(); 
                        notif.close(); 
                    };
                } catch(e) { console.log("Bildirim hatasÄ±:", e); }
            }

            document.getElementById('alarm-country-title').innerText = rem.country;
            document.getElementById('alarm-note-display').innerText = rem.note;
            document.getElementById('alarm-overlay').classList.remove('hidden');

            reminders = reminders.filter(r => r.id !== rem.id);
            localStorage.setItem('kronos_reminders', JSON.stringify(reminders));
            updateBadge();
        }

        function dismissAlarm() {
            document.getElementById('alarm-overlay').classList.add('hidden');
            activeAlarm = null;
            stopTitleFlash();
        }

        function flashTitle(msg1, msg2) {
            if(titleInterval) clearInterval(titleInterval);
            let state = false;
            titleInterval = setInterval(() => {
                document.title = state ? msg1 : msg2;
                state = !state;
            }, 1000);
        }

        function stopTitleFlash() {
            if(titleInterval) clearInterval(titleInterval);
            document.title = "Kronos - KÃ¼resel Takip";
        }

        function toggleReminderList() {
            const el = document.getElementById('list-modal');
            if(el.classList.contains('hidden')) {
                renderReminders();
                el.classList.remove('hidden');
            } else {
                el.classList.add('hidden');
            }
        }

        function renderReminders() {
            const list = document.getElementById('active-reminders-list');
            list.innerHTML = "";
            if(reminders.length === 0) list.innerHTML = "<p class='text-gray-500 text-center mt-10'>Aktif alarm yok.</p>";
            
            reminders.sort((a,b) => a.targetTime - b.targetTime).forEach(r => {
                const minLeft = Math.ceil((r.targetTime - Date.now())/60000);
                list.innerHTML += `
                    <div class="bg-gray-800 p-3 rounded flex justify-between items-center border border-gray-700">
                        <div>
                            <div class="font-bold text-orange-400">${r.country}</div>
                            <div class="text-xs text-gray-400">${r.displayTime} (${minLeft} dk kaldÄ±)</div>
                            <div class="text-sm text-white">${r.note}</div>
                        </div>
                        <button onclick="deleteReminder(${r.id})" class="text-red-500 hover:text-red-300 font-bold text-xl">&times;</button>
                    </div>
                `;
            });
        }

        function deleteReminder(id) {
            reminders = reminders.filter(r => r.id !== id);
            localStorage.setItem('kronos_reminders', JSON.stringify(reminders));
            renderReminders();
            updateBadge();
        }

        function updateBadge() {
            const badge = document.getElementById('alarm-badge');
            if(reminders.length > 0) badge.classList.remove('hidden');
            else badge.classList.add('hidden');
        }

        function updateTime() {
            checkReminders();
            const now = new Date();
            const options = { timeZone: selectedCountry.tz, hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' };
            try {
                const timeStr = new Intl.DateTimeFormat('tr-TR', options).format(now);
                document.getElementById('main-clock').innerText = timeStr;
                const dateStr = new Intl.DateTimeFormat('tr-TR', { timeZone: selectedCountry.tz, day:'numeric', month:'long', weekday:'long'}).format(now);
                document.getElementById('date-display').innerText = dateStr;
                document.getElementById('selected-country-name').innerText = selectedCountry.name;
                const flag = document.getElementById('selected-country-flag');
                flag.src = `https://flagcdn.com/w80/${selectedCountry.code}.png`;
                flag.classList.remove('hidden');
            } catch(e) {}
        }

        let targetRot = { x:0, y:0 };
        function focusCountry(c) {
            selectedCountry = c;
            updateTime();
            targetRot.x = c.lat * (Math.PI/180);
            targetRot.y = -c.lon * (Math.PI/180);
            const phi = (90 - c.lat) * (Math.PI/180);
            const theta = (c.lon + 180) * (Math.PI/180);
            const x = -(5 * Math.sin(phi) * Math.cos(theta));
            const z = (5 * Math.sin(phi) * Math.sin(theta));
            const y = (5 * Math.cos(phi));
            markerGroup.position.set(0,0,0);
            markerGroup.lookAt(x,y,z);
        }

        function renderList(search="") {
            const list = document.getElementById('country-list');
            list.innerHTML = "";
            countries.filter(c => c.name.toLowerCase().includes(search.toLowerCase())).forEach(c => {
                const active = c.name === selectedCountry.name ? 'active' : '';
                list.innerHTML += `
                    <div onclick="focusCountry(countries.find(x=>x.code=='${c.code}'))" class="country-item p-3 cursor-pointer flex items-center gap-3 ${active}">
                        <img src="https://flagcdn.com/w40/${c.code}.png" class="w-6 rounded shadow opacity-80">
                        <div class="text-sm font-bold text-gray-300">${c.name.split('(')[0]}</div>
                    </div>
                `;
            });
        }

        function animate() {
            requestAnimationFrame(animate);
            const targetY = targetRot.y + Math.PI/2;
            earthGroup.rotation.y += (targetY - earthGroup.rotation.y) * 0.05;
            earthGroup.rotation.x += (targetRot.x - earthGroup.rotation.x) * 0.05;
            scene.rotation.y += 0.0002;
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        document.getElementById('search-input').addEventListener('input', (e) => renderList(e.target.value));

        focusCountry(countries[0]);
        renderList();
        updateBadge();
        animate();
        setInterval(updateTime, 1000);

    </script>
</body>
</html>
