<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CASA 36</title>
    
    <!-- Tailwind CSS (Stil) -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Three.js (3D DÃ¼nya Animasyonu) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- FontAwesome (Ä°konlar) -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Rajdhani:wght@400;600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        casaBlue: '#007BFF',   /* Enerjik Mavi */
                        casaOrange: '#FF8C00', /* CanlÄ± Turuncu */
                        casaGreen: '#00C853',  /* Neon YeÅŸil */
                        casaWhite: '#FFFFFF',
                        casaDark: '#0a192f',
                    },
                    fontFamily: {
                        sans: ['Rajdhani', 'sans-serif'],
                        mono: ['Orbitron', 'monospace'],
                    }
                }
            }
        }
    </script>

    <style>
        body { margin: 0; overflow: hidden; background-color: #0a192f; color: white; }
        
        /* Glassmorphism Paneller */
        .glass-panel {
            background: rgba(10, 25, 47, 0.65);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }

        /* Scrollbar Ã–zelleÅŸtirme */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.3); }
        ::-webkit-scrollbar-thumb { background: #007BFF; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #FF8C00; }

        /* Animasyonlar */
        @keyframes blink { 50% { opacity: 0; } }
        .blink-anim { animation: blink 1s linear infinite; }
        
        @keyframes pulse-border {
            0% { box-shadow: 0 0 0 0 rgba(255, 140, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 140, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 140, 0, 0); }
        }
        .alarm-active { animation: pulse-border 2s infinite; border: 2px solid #FF8C00; }

        #globe-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.8; 
        }
        
        /* UI KatmanlarÄ± */
        #ui-layer { position: relative; z-index: 10; height: 100vh; display: flex; flex-direction: column; }
    </style>
</head>
<body>

    <!-- 3D Arka Plan -->
    <div id="globe-container"></div>

    <!-- Ana ArayÃ¼z -->
    <div id="ui-layer" class="p-4 md:p-8">
        
        <!-- Header / Logo -->
        <header class="flex justify-between items-center mb-6">
            <div class="flex items-center gap-3">
                <div class="w-12 h-12 bg-casaOrange rounded-full flex items-center justify-center text-casaWhite font-mono font-bold text-xl shadow-lg border-2 border-white">
                    36
                </div>
                <div>
                    <h1 class="text-3xl font-bold tracking-widest text-casaWhite drop-shadow-md">CASA</h1>
                    <span class="text-xs text-casaGreen tracking-widest uppercase">Global Time System</span>
                </div>
            </div>
            
            <!-- Ãœst Kontrol -->
            <button onclick="toggleCountryList()" class="bg-casaBlue/80 hover:bg-casaBlue text-white px-4 py-2 rounded-lg transition border border-white/20 flex items-center gap-2">
                <i class="fa-solid fa-globe"></i> Ãœlke DeÄŸiÅŸtir
            </button>
        </header>

        <!-- Ana Ä°Ã§erik Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6 flex-1 overflow-hidden">
            
            <!-- Sol: Ana Saat ve Bilgi -->
            <div class="lg:col-span-8 flex flex-col justify-center items-center text-center glass-panel rounded-3xl p-8 relative overflow-hidden transition-all duration-500" id="clock-panel">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-casaBlue via-casaWhite to-casaGreen"></div>
                
                <div class="mb-2">
                    <span id="current-country-flag" class="text-6xl drop-shadow-lg">ðŸ‡¹ðŸ‡·</span>
                </div>
                <h2 id="current-country-name" class="text-2xl md:text-4xl font-bold text-casaOrange mb-2 uppercase tracking-wide">TÃ¼rkiye</h2>
                <div id="day-status" class="text-casaGreen text-lg font-semibold mb-4 flex items-center gap-2 justify-center">
                    <i class="fa-regular fa-sun"></i> <span>Ã–ÄŸlen</span>
                </div>

                <!-- BÃ¼yÃ¼k Dijital Saat -->
                <div class="font-mono text-7xl md:text-9xl font-bold text-white drop-shadow-[0_0_15px_rgba(0,123,255,0.8)] tracking-tighter" id="main-clock">
                    12:00:00
                </div>
                <div class="text-xl text-gray-300 mt-2 font-mono" id="main-date">
                    24 KasÄ±m 2025, Pazartesi
                </div>

                <!-- Alarm Durumu GÃ¶stergesi -->
                <div id="next-alarm-display" class="mt-8 px-6 py-2 rounded-full bg-white/10 text-sm text-casaOrange hidden">
                    <i class="fa-solid fa-bell"></i> SÄ±rada: <span id="next-alarm-time">--:--</span>
                </div>
            </div>

            <!-- SaÄŸ: Alarm ve AraÃ§lar -->
            <div class="lg:col-span-4 flex flex-col gap-4">
                
                <!-- Alarm Kurma Paneli -->
                <div class="glass-panel rounded-2xl p-6 flex-1 flex flex-col">
                    <h3 class="text-xl font-bold text-casaWhite mb-4 flex items-center gap-2 border-b border-white/10 pb-2">
                        <i class="fa-solid fa-clock text-casaOrange"></i> Alarm Kur
                    </h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="text-xs text-gray-400 block mb-1">SeÃ§ili Ãœlke Saatine GÃ¶re</label>
                            <input type="time" id="alarm-time-input" class="w-full bg-black/40 border border-casaBlue/50 text-white rounded p-3 font-mono text-xl focus:border-casaOrange outline-none transition">
                        </div>
                        <div>
                            <input type="text" id="alarm-note-input" placeholder="Alarm Notu (Ã¶rn: ToplantÄ±)" class="w-full bg-black/40 border border-white/10 text-white rounded p-3 text-sm focus:border-casaGreen outline-none transition">
                        </div>
                        <button onclick="addAlarm()" class="w-full bg-casaGreen hover:bg-green-600 text-black font-bold py-3 rounded-lg transition shadow-[0_0_15px_rgba(0,200,83,0.4)]">
                            <i class="fa-solid fa-plus"></i> AlarmÄ± Ekle
                        </button>
                    </div>

                    <!-- Alarm Listesi -->
                    <div class="mt-6 flex-1 overflow-y-auto">
                        <h4 class="text-sm text-casaBlue font-bold mb-2 uppercase">Aktif Alarmlar</h4>
                        <ul id="alarm-list" class="space-y-2">
                            <!-- JS ile doldurulacak -->
                            <li class="text-center text-gray-500 text-sm py-4">HenÃ¼z alarm yok.</li>
                        </ul>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- Ãœlke SeÃ§im ModalÄ± (Overlay) -->
    <div id="country-modal" class="fixed inset-0 bg-black/80 backdrop-blur-md z-50 hidden flex justify-center items-center p-4">
        <div class="bg-[#0a192f] border border-casaBlue w-full max-w-2xl max-h-[80vh] rounded-2xl flex flex-col shadow-[0_0_50px_rgba(0,123,255,0.3)]">
            <div class="p-6 border-b border-white/10 flex justify-between items-center">
                <h2 class="text-2xl font-bold text-white"><i class="fa-solid fa-earth-americas text-casaBlue"></i> Ãœlke SeÃ§imi</h2>
                <button onclick="toggleCountryList()" class="text-gray-400 hover:text-white text-2xl"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="p-4">
                <input type="text" id="country-search" onkeyup="filterCountries()" placeholder="Ãœlke ara..." class="w-full bg-black/50 border border-white/20 rounded-lg p-3 text-white focus:border-casaOrange outline-none">
            </div>
            <div class="overflow-y-auto flex-1 p-4 grid grid-cols-1 md:grid-cols-2 gap-3" id="country-grid">
                <!-- JS ile doldurulacak -->
            </div>
        </div>
    </div>

    <!-- Alarm Ã‡aldÄ±ÄŸÄ±nda AÃ§Ä±lan Ekran -->
    <div id="alarm-ringing-modal" class="fixed inset-0 bg-casaOrange/90 z-[60] hidden flex flex-col justify-center items-center text-center p-8">
        <div class="w-24 h-24 bg-white rounded-full flex items-center justify-center mb-6 animate-bounce shadow-2xl">
            <span class="text-4xl text-casaOrange font-bold">36</span>
        </div>
        <h1 class="text-5xl md:text-7xl font-bold text-white mb-4 drop-shadow-lg">ALARM!</h1>
        <p id="ringing-note" class="text-2xl text-white font-mono mb-8 bg-black/20 px-6 py-2 rounded-lg">Not Yok</p>
        <p id="ringing-time" class="text-xl text-white/80 mb-8 font-mono"></p>
        
        <div class="flex gap-4">
            <button onclick="snoozeAlarm()" class="bg-white text-casaOrange px-8 py-4 rounded-full font-bold text-xl hover:bg-gray-100 shadow-lg transition transform hover:scale-105">
                <i class="fa-solid fa-stopwatch"></i> 5 Dk Ertele
            </button>
            <button onclick="dismissAlarm()" class="bg-black/80 text-white px-8 py-4 rounded-full font-bold text-xl hover:bg-black shadow-lg transition transform hover:scale-105 border border-white/30">
                <i class="fa-solid fa-check"></i> Kapat
            </button>
        </div>
    </div>

    <!-- Ses DosyasÄ± (TarayÄ±cÄ±da osilatÃ¶r kullanÄ±lacak, yedek olarak HTML Audio yok) -->

    <script>
        // --- VERÄ° TABANI (Ãœlkeler, Koordinatlar, Saat Dilimleri) ---
        // Koordinatlar [Lat, Lon] (Enlem, Boylam) Three.js rotasyonu iÃ§in.
        const countries = [
            { code: 'TR', name: 'TÃ¼rkiye', flag: 'ðŸ‡¹ðŸ‡·', zone: 'Europe/Istanbul', coords: [39, 35] },
            { code: 'US-NY', name: 'ABD (New York)', flag: 'ðŸ‡ºðŸ‡¸', zone: 'America/New_York', coords: [40, -74] },
            { code: 'GB', name: 'Ä°ngiltere', flag: 'ðŸ‡¬ðŸ‡§', zone: 'Europe/London', coords: [51, 0] },
            { code: 'JP', name: 'Japonya', flag: 'ðŸ‡¯ðŸ‡µ', zone: 'Asia/Tokyo', coords: [36, 138] },
            { code: 'DE', name: 'Almanya', flag: 'ðŸ‡©ðŸ‡ª', zone: 'Europe/Berlin', coords: [51, 10] },
            { code: 'FR', name: 'Fransa', flag: 'ðŸ‡«ðŸ‡·', zone: 'Europe/Paris', coords: [46, 2] },
            { code: 'CN', name: 'Ã‡in', flag: 'ðŸ‡¨ðŸ‡³', zone: 'Asia/Shanghai', coords: [35, 105] },
            { code: 'RU', name: 'Rusya (Moskova)', flag: 'ðŸ‡·ðŸ‡º', zone: 'Europe/Moscow', coords: [55, 37] },
            { code: 'AU', name: 'Avustralya (Sidney)', flag: 'ðŸ‡¦ðŸ‡º', zone: 'Australia/Sydney', coords: [-33, 151] },
            { code: 'BR', name: 'Brezilya', flag: 'ðŸ‡§ðŸ‡·', zone: 'America/Sao_Paulo', coords: [-14, -51] },
            { code: 'IN', name: 'Hindistan', flag: 'ðŸ‡®ðŸ‡³', zone: 'Asia/Kolkata', coords: [20, 77] },
            { code: 'AE', name: 'BirleÅŸik Arap Emirlikleri', flag: 'ðŸ‡¦ðŸ‡ª', zone: 'Asia/Dubai', coords: [23, 54] },
            { code: 'KR', name: 'GÃ¼ney Kore', flag: 'ðŸ‡°ðŸ‡·', zone: 'Asia/Seoul', coords: [35, 127] },
            { code: 'CA', name: 'Kanada (Toronto)', flag: 'ðŸ‡¨ðŸ‡¦', zone: 'America/Toronto', coords: [43, -79] },
            { code: 'ZA', name: 'GÃ¼ney Afrika', flag: 'ðŸ‡¿ðŸ‡¦', zone: 'Africa/Johannesburg', coords: [-30, 25] },
            { code: 'MX', name: 'Meksika', flag: 'ðŸ‡²ðŸ‡½', zone: 'America/Mexico_City', coords: [19, -99] },
            { code: 'IT', name: 'Ä°talya', flag: 'ðŸ‡®ðŸ‡¹', zone: 'Europe/Rome', coords: [41, 12] },
            { code: 'ES', name: 'Ä°spanya', flag: 'ðŸ‡ªðŸ‡¸', zone: 'Europe/Madrid', coords: [40, -3] },
            { code: 'AZ', name: 'Azerbaycan', flag: 'ðŸ‡¦ðŸ‡¿', zone: 'Asia/Baku', coords: [40, 47] }
        ];

        // --- GLOBAL DEÄžÄ°ÅžKENLER ---
        let currentCountry = countries[0]; // VarsayÄ±lan: TÃ¼rkiye
        let alarms = [];
        let alarmCheckInterval;
        let isAlarmRinging = false;
        let activeRingingAlarm = null;
        let originalTitle = document.title;
        let titleInterval = null;

        // --- THREE.JS KURULUMU (3D DÃœNYA) ---
        let scene, camera, renderer, globe, stars;
        let targetRotation = { x: 0, y: 0 };

        function initThreeJS() {
            const container = document.getElementById('globe-container');
            
            // Sahne
            scene = new THREE.Scene();
            // Sis efekti (derinlik iÃ§in)
            scene.fog = new THREE.FogExp2(0x0a192f, 0.002);

            // Kamera
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 25; // KamerayÄ± uzaklaÅŸtÄ±r
            camera.position.x = 10; // Hafif saÄŸa al ki saat gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ kapatmasÄ±n

            // Renderer
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            container.appendChild(renderer.domElement);

            // DÃ¼nya (KÃ¼re) - Wireframe (Tel Kafes)
            // Enerjik gÃ¶rÃ¼nÃ¼m iÃ§in IcosahedronGeometry kullanÄ±yoruz
            const geometry = new THREE.IcosahedronGeometry(10, 3); // Detay seviyesi 3
            
            const material = new THREE.MeshBasicMaterial({ 
                color: 0x007BFF, // Mavi tel kafes
                wireframe: true,
                transparent: true,
                opacity: 0.15
            });
            
            globe = new THREE.Mesh(geometry, material);
            scene.add(globe);

            // Ä°kinci bir katman (Ã‡ekirdek) - Turuncu parÄ±ltÄ±
            const coreGeo = new THREE.IcosahedronGeometry(9.8, 2);
            const coreMat = new THREE.MeshBasicMaterial({
                color: 0xFF8C00, // Turuncu
                wireframe: true,
                transparent: true,
                opacity: 0.05
            });
            const core = new THREE.Mesh(coreGeo, coreMat);
            globe.add(core);

            // YÄ±ldÄ±zlar (Arka plan parÃ§acÄ±klarÄ±)
            const starGeo = new THREE.BufferGeometry();
            const starCount = 1000;
            const posArray = new Float32Array(starCount * 3);
            for(let i=0; i<starCount * 3; i++) {
                posArray[i] = (Math.random() - 0.5) * 100;
            }
            starGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
            const starMat = new THREE.PointsMaterial({
                size: 0.1,
                color: 0xFFFFFF,
                transparent: true,
                opacity: 0.5
            });
            stars = new THREE.Points(starGeo, starMat);
            scene.add(stars);

            // IÅŸÄ±klar
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.5);
            scene.add(ambientLight);
            const pointLight = new THREE.PointLight(0x00C853, 1);
            pointLight.position.set(20, 20, 20);
            scene.add(pointLight);

            animate();
            updateGlobePosition(currentCountry.coords);
        }

        function animate() {
            requestAnimationFrame(animate);

            // SÃ¼rekli hafif dÃ¶nÃ¼ÅŸ
            globe.rotation.y += 0.001;
            stars.rotation.y -= 0.0005;

            // Hedef pozisyona yumuÅŸak geÃ§iÅŸ (Lerp)
            // Not: Tam coÄŸrafi haritalama yapmÄ±yoruz, sanatsal bir dÃ¶nÃ¼ÅŸ yapÄ±yoruz.
            // Boylam (Lon) Y ekseni rotasyonunu etkiler.
            
            renderer.render(scene, camera);
        }

        function updateGlobePosition(coords) {
            // Basit bir gÃ¶rsel geri bildirim: Ãœlke deÄŸiÅŸince dÃ¶nÃ¼ÅŸ hÄ±zÄ± veya rengi geÃ§ici olarak parlasÄ±n
            // coords: [Lat, Lon]
            
            // Globe materyal rengini anlÄ±k deÄŸiÅŸtir (GÃ¶rsel tepki)
            globe.material.color.setHex(0xFFFFFF); // Beyaz flaÅŸ
            setTimeout(() => {
                globe.material.color.setHex(0x007BFF); // Maviye dÃ¶n
            }, 300);

            // KamerayÄ± hafifÃ§e kaydÄ±r (Paralaks etkisi iÃ§in)
            // const lat = coords[0];
            // const lon = coords[1];
            // ThreeJS karmaÅŸÄ±k rotasyon matematiÄŸi yerine estetik bir efekt kullanacaÄŸÄ±z.
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }
        window.addEventListener('resize', onWindowResize);


        // --- SAAT VE UI MANTIÄžI ---

        function updateClock() {
            const now = new Date();
            
            // SeÃ§ilen Ã¼lkenin saat dilimine gÃ¶re zamanÄ± al
            const options = { timeZone: currentCountry.zone, hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' };
            const timeString = now.toLocaleTimeString('tr-TR', options);
            
            // Tarih
            const dateOptions = { timeZone: currentCountry.zone, weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateString = now.toLocaleDateString('tr-TR', dateOptions);

            document.getElementById('main-clock').textContent = timeString;
            document.getElementById('main-date').textContent = dateString;

            // GÃ¼n Durumu (Sabah/Ã–ÄŸle/AkÅŸam)
            // Saat bilgisini parse et
            const hour = parseInt(now.toLocaleTimeString('en-US', { timeZone: currentCountry.zone, hour12: false, hour: '2-digit' }));
            
            let statusText = "";
            let statusIcon = "";
            let statusColor = "";

            if (hour >= 5 && hour < 12) {
                statusText = "Sabah";
                statusIcon = '<i class="fa-solid fa-mug-hot"></i>';
                statusColor = "text-casaOrange";
            } else if (hour >= 12 && hour < 17) {
                statusText = "Ã–ÄŸlen";
                statusIcon = '<i class="fa-solid fa-sun"></i>';
                statusColor = "text-yellow-400";
            } else if (hour >= 17 && hour < 22) {
                statusText = "AkÅŸam";
                statusIcon = '<i class="fa-solid fa-moon"></i>';
                statusColor = "text-casaBlue";
            } else {
                statusText = "Gece";
                statusIcon = '<i class="fa-solid fa-star"></i>';
                statusColor = "text-gray-400";
            }

            const statusEl = document.getElementById('day-status');
            statusEl.innerHTML = `${statusIcon} <span>${statusText}</span>`;
            statusEl.className = `text-lg font-semibold mb-4 flex items-center gap-2 justify-center ${statusColor}`;

            checkAlarms(timeString);
        }

        // --- ALARM SÄ°STEMÄ° ---

        // Ses Ãœreteci (AudioContext - DosyasÄ±z ses)
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        function playAlarmSound() {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.type = 'square'; // Keskin, rahatsÄ±z edici bir ses (alarm iÃ§in)
            oscillator.frequency.setValueAtTime(440, audioCtx.currentTime); // A4 nota
            oscillator.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.5); // YÃ¼kselen ses
            
            // Kesik kesik Ã§alma efekti
            gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.5);

            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            oscillator.start();
            oscillator.stop(audioCtx.currentTime + 0.5);
        }

        function loopAlarmSound() {
            if(!isAlarmRinging) return;
            playAlarmSound();
            setTimeout(loopAlarmSound, 600); // 0.6 saniyede bir tekrarla
        }

        function checkAlarms(currentTimeString) { // currentTimeString format: "HH:MM:SS"
            const currentHM = currentTimeString.substring(0, 5); // "HH:MM"

            alarms.forEach(alarm => {
                if (alarm.active && !alarm.snoozed && alarm.countryCode === currentCountry.code) {
                    if (alarm.time === currentHM && !isAlarmRinging) {
                        triggerAlarm(alarm);
                    }
                }
            });
        }

        function triggerAlarm(alarm) {
            isAlarmRinging = true;
            activeRingingAlarm = alarm;
            
            // GÃ¶rsel
            document.getElementById('alarm-ringing-modal').classList.remove('hidden');
            document.getElementById('ringing-note').textContent = alarm.note || "Not Yok";
            document.getElementById('ringing-time').textContent = alarm.time;

            // Ses
            loopAlarmSound();

            // Tab YanÄ±p SÃ¶nme (EÄŸer kullanÄ±cÄ± baÅŸka sayfadaysa)
            if (document.hidden) {
                startTitleBlink();
            }
        }

        function startTitleBlink() {
            if (titleInterval) clearInterval(titleInterval);
            titleInterval = setInterval(() => {
                document.title = document.title === "ALARM!" ? "CASA 36" : "ALARM!";
            }, 1000);
        }

        function stopTitleBlink() {
            clearInterval(titleInterval);
            document.title = originalTitle;
        }

        function dismissAlarm() {
            isAlarmRinging = false;
            document.getElementById('alarm-ringing-modal').classList.add('hidden');
            stopTitleBlink();
            
            // AlarmÄ± pasif yap
            const index = alarms.indexOf(activeRingingAlarm);
            if (index > -1) {
                alarms[index].active = false; // Tek seferlik alarm, kapatÄ±nca pasif olur.
                renderAlarms();
            }
        }

        function snoozeAlarm() {
            // 5 dakika ertele
            isAlarmRinging = false;
            document.getElementById('alarm-ringing-modal').classList.add('hidden');
            stopTitleBlink();

            if (activeRingingAlarm) {
                activeRingingAlarm.snoozed = true;
                // 5 dakika (300000 ms) sonra snooze durumunu kaldÄ±r
                setTimeout(() => {
                    activeRingingAlarm.snoozed = false;
                }, 300000); 
                
                // Basitlik iÃ§in notu gÃ¼ncelle
                activeRingingAlarm.note = "(Ertelendi) " + activeRingingAlarm.note;
                renderAlarms();
            }
        }

        function addAlarm() {
            const timeInput = document.getElementById('alarm-time-input').value;
            const noteInput = document.getElementById('alarm-note-input').value;

            if (!timeInput) {
                alert("LÃ¼tfen bir saat seÃ§in.");
                return;
            }

            const newAlarm = {
                id: Date.now(),
                time: timeInput,
                countryCode: currentCountry.code, // Alarm o anki seÃ§ili Ã¼lkeye baÄŸlanÄ±r
                countryName: currentCountry.name,
                note: noteInput,
                active: true,
                snoozed: false
            };

            alarms.push(newAlarm);
            
            // InputlarÄ± temizle
            document.getElementById('alarm-note-input').value = "";
            
            renderAlarms();
            
            // Bildirim
            const btn = document.querySelector('button[onclick="addAlarm()"]');
            const originalText = btn.innerHTML;
            btn.innerHTML = '<i class="fa-solid fa-check"></i> Eklendi!';
            setTimeout(() => btn.innerHTML = originalText, 2000);
        }

        function deleteAlarm(id) {
            alarms = alarms.filter(a => a.id !== id);
            renderAlarms();
        }

        function toggleAlarm(id) {
            const alarm = alarms.find(a => a.id === id);
            if (alarm) {
                alarm.active = !alarm.active;
                alarm.snoozed = false; // AktifliÄŸi deÄŸiÅŸirse snooze sÄ±fÄ±rlanÄ±r
                renderAlarms();
            }
        }

        function renderAlarms() {
            const list = document.getElementById('alarm-list');
            list.innerHTML = "";

            if (alarms.length === 0) {
                list.innerHTML = '<li class="text-center text-gray-500 text-sm py-4">HenÃ¼z alarm yok.</li>';
                return;
            }

            // Saat sÄ±rasÄ±na gÃ¶re diz
            alarms.sort((a, b) => a.time.localeCompare(b.time));

            alarms.forEach(alarm => {
                const li = document.createElement('li');
                li.className = `flex justify-between items-center bg-white/5 p-3 rounded-lg border-l-4 ${alarm.active ? 'border-casaGreen' : 'border-gray-600'} hover:bg-white/10 transition`;
                
                li.innerHTML = `
                    <div class="flex-1">
                        <div class="flex items-baseline gap-2">
                            <span class="font-mono text-xl ${alarm.active ? 'text-white' : 'text-gray-500'}">${alarm.time}</span>
                            <span class="text-xs text-casaOrange uppercase">${alarm.countryName}</span>
                        </div>
                        <div class="text-xs text-gray-400 truncate">${alarm.note || 'Not yok'}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="toggleAlarm(${alarm.id})" class="text-gray-300 hover:text-white p-2">
                            <i class="fa-solid ${alarm.active ? 'fa-toggle-on text-casaGreen' : 'fa-toggle-off'}"></i>
                        </button>
                        <button onclick="deleteAlarm(${alarm.id})" class="text-gray-300 hover:text-red-500 p-2">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </div>
                `;
                list.appendChild(li);
            });
        }

        // --- ÃœLKE SEÃ‡Ä°M MANTIÄžI ---

        function toggleCountryList() {
            const modal = document.getElementById('country-modal');
            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                document.getElementById('country-search').focus();
                renderCountryGrid(countries);
            } else {
                modal.classList.add('hidden');
            }
        }

        function selectCountry(code) {
            currentCountry = countries.find(c => c.code === code);
            
            // UI GÃ¼ncelle
            document.getElementById('current-country-name').textContent = currentCountry.name;
            document.getElementById('current-country-flag').textContent = currentCountry.flag;
            
            // Saati anÄ±nda gÃ¼ncelle
            updateClock();
            
            // 3D DÃ¼nya Pozisyonunu gÃ¼ncelle
            updateGlobePosition(currentCountry.coords);

            // ModalÄ± kapat
            toggleCountryList();
        }

        function renderCountryGrid(list) {
            const grid = document.getElementById('country-grid');
            grid.innerHTML = "";
            
            list.forEach(c => {
                const div = document.createElement('div');
                div.className = "flex items-center gap-3 p-3 rounded bg-white/5 hover:bg-casaBlue/20 cursor-pointer transition border border-transparent hover:border-casaBlue";
                div.onclick = () => selectCountry(c.code);
                
                // O anki saati hesapla (Ã¶nizleme iÃ§in)
                const timePreview = new Date().toLocaleTimeString('tr-TR', { timeZone: c.zone, hour: '2-digit', minute: '2-digit' });
                
                div.innerHTML = `
                    <span class="text-3xl">${c.flag}</span>
                    <div class="flex-1">
                        <div class="font-bold text-white text-sm">${c.name}</div>
                        <div class="text-xs text-casaOrange">${c.zone}</div>
                    </div>
                    <div class="font-mono text-casaGreen font-bold">${timePreview}</div>
                `;
                grid.appendChild(div);
            });
        }

        function filterCountries() {
            const query = document.getElementById('country-search').value.toLowerCase();
            const filtered = countries.filter(c => c.name.toLowerCase().includes(query));
            renderCountryGrid(filtered);
        }

        // --- BAÅžLATMA ---

        window.onload = function() {
            initThreeJS();
            
            // Saati her saniye gÃ¼ncelle
            updateClock();
            setInterval(updateClock, 1000);

            // AlarmlarÄ± render et (boÅŸ)
            renderAlarms();

            // Sayfa gÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼ deÄŸiÅŸtiÄŸinde (Tab deÄŸiÅŸimi)
            document.addEventListener("visibilitychange", () => {
                if (!document.hidden && isAlarmRinging) {
                    stopTitleBlink(); // Sekmeye geri dÃ¶ndÃ¼, yanÄ±p sÃ¶nmeyi durdur ama alarm devam etsin
                }
            });
        };

    </script>
</body>
</html>